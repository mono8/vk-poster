(this["webpackJsonpvk-bot"]=this["webpackJsonpvk-bot"]||[]).push([[0],{37:function(e,t,n){e.exports={wrapper:"Group_wrapper__17gz7",link:"Group_link__Lsc18",groupName:"Group_groupName__4g0ea",image:"Group_image__2fvKh"}},49:function(e,t,n){e.exports={photoInput:"SendingForm_photoInput__2QH4b",form:"SendingForm_form__1Jg2e"}},50:function(e,t,n){e.exports={container:"Token_container__3nGR6",label:"Token_label__1_3FU"}},59:function(e,t,n){e.exports={wrapper:"Groups_wrapper__1oPfr"}},70:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(9),c=n.n(a),o=(n(70),n(121)),s=n(30),u=n(115),i=n(120),l=n(118),p=n(123),f=n(37),d=n.n(f),h=n(3),b=n(36),j=function(){return Object(b.b)()},m=b.c,g=n(54),v=n(15),O=n.n(v),k=n(24),x=n(18),_=n(17),w=n(33),y=n.n(w),C=5.103;function G(e){return new Promise((function(t){return setTimeout(t,e)}))}var N=Object(_.b)("groups/fetchGroups",(function(e){return new Promise((function(t,n){y()("https://api.vk.com/method/groups.get?fields=can_post&count&extended=1&access_token=".concat(e,"&v=").concat(C),void 0,(function(e,r){if(e)console.error(e),n(e);else{var a=r.response.items.map((function(e){return Object(x.a)(Object(x.a)({},e),{},{checked:!1,status:"none"})}));t(a)}}))}))})),S=Object(_.b)("status/sendMessage",function(){var e=Object(k.a)(O.a.mark((function e(t){var n,r,a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.group,r=t.message,a=t.photoUrl,c=t.token,e.abrupt("return",new Promise((function(e,t){y()("https://api.vk.com/method/wall.post?owner_id=-".concat(n.id,"&message=").concat(r,"&attachments=").concat(a,"&access_token=").concat(c,"&v=").concat(C),void 0,(function(r,a){r?(console.error("group ".concat(n.id," ")+r.message),t(n.id)):e(n.id)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),I=Object(_.b)("groups/sendMessagesToAllGroups",function(){var e=Object(k.a)(O.a.mark((function e(t,n){var r,a,c,o,s,u,i,l,p,f;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.message,a=t.photoUrl,c=n.getState,o=n.dispatch,s=c(),u=s.groups.filter((function(e){return e.checked})),i=s.user.token,l=Object(g.a)(u),e.prev=6,l.s();case 8:if((p=l.n()).done){e.next=16;break}return f=p.value,e.next=12,o(S({group:f,message:r,photoUrl:a,token:i}));case 12:return e.next=14,G(500);case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),l.e(e.t0);case 21:return e.prev=21,l.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[6,18,21,24]])})));return function(t,n){return e.apply(this,arguments)}}()),P=Object(_.c)({name:"groups",initialState:[],reducers:{setGroups:function(e,t){return t.payload},toggleGroup:function(e,t){var n=e.find((function(e){return e.id===t.payload}));n&&(n.checked=!n.checked)},checkAllGroups:function(e){return e.map((function(e){return Object(x.a)(Object(x.a)({},e),{},{checked:!0})}))},uncheckAllGroups:function(e){return e.map((function(e){return Object(x.a)(Object(x.a)({},e),{},{checked:!1})}))},setGroupStatus:function(e,t){var n=e.find((function(e){return e.id===t.payload.id}));n&&(n.status=t.payload.status)},resetAllGroupsStatuses:function(e){return e.map((function(e){return Object(x.a)(Object(x.a)({},e),{},{status:"none"})}))}},extraReducers:function(e){e.addCase(N.fulfilled,(function(e,t){return t.payload})).addCase(S.fulfilled,(function(e,t){var n=e.find((function(e){return e.id===t.payload}));n&&(n.status="success")})).addCase(S.rejected,(function(e,t){var n=e.find((function(e){return e.id===t.payload}));n&&(n.status="failed")}))}}),A=P.actions,F=A.toggleGroup,R=A.checkAllGroups,T=A.uncheckAllGroups,U=(A.setGroups,A.resetAllGroupsStatuses),E=P.reducer,W=n(44),J=n(45),z=n(43),B=n(5),L=Object(u.a)((function(e){return{isChecked:{backgroundColor:W.a[100]},success:{backgroundColor:J.a[200]},error:{backgroundColor:z.a[300]}}})),M=function(e){var t=e.group,n=j(),r=function(){n(F(t.id))},a=L();return Object(B.jsxs)(l.a,{className:Object(h.a)(d.a.wrapper,t.checked&&a.isChecked,"success"===t.status&&a.success,"failed"===t.status&&a.error),children:[Object(B.jsx)(p.a,{checked:t.checked,onChange:r,color:"primary",inputProps:{"aria-label":"secondary checkbox"}}),Object(B.jsx)("span",{className:d.a.groupName,onClick:r,children:t.name}),Object(B.jsx)("a",{href:"https://vk.com/"+t.screen_name,className:d.a.link,target:"_blank",rel:"noreferrer",children:Object(B.jsx)("img",{className:d.a.image,src:t.photo_50,alt:t.screen_name})})]})},D=n(59),H=n.n(D),K=Object(u.a)((function(e){return{root:{margin:"16px 16px 16px 0"}}})),Q=function(e){var t=Object(r.useState)(!0),n=Object(s.a)(t,2),a=n[0],c=n[1],o=K(),u=m((function(e){return e.user.token})),l=j(),p=m((function(e){return e.groups})),f=m((function(e){return e.groups.some((function(e){return"failed"===e.status||"success"===e.status}))}));Object(r.useEffect)((function(){u&&l(N(u))}),[u,l]);return p.length?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(i.a,{variant:"contained",onClick:function(){l(a?R():T()),c(!a)},className:o.root,children:"\u041f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c/\u0443\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u0433\u0430\u043b\u043a\u0438"}),f&&Object(B.jsx)(i.a,{variant:"contained",onClick:function(){l(U())},className:Object(h.a)(o.root),children:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438"}),Object(B.jsx)("div",{className:H.a.wrapper,children:p.map((function(e){return Object(B.jsx)(M,{group:e},e.id)}))})]}):null},$=n(122),q=n(49),V=n.n(q),X=Object(u.a)((function(e){return{textField:{width:400}}})),Y=function(e){var t=e.message,n=e.onChange,r=X();return Object(B.jsx)($.a,{label:"\u0428\u0430\u043f\u043a\u0430",multiline:!0,minRows:10,maxRows:40,className:r.textField,margin:"normal",variant:"outlined",value:t,onChange:n})},Z=function(e){var t=Object(r.useState)(!1),n=Object(s.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(localStorage.getItem("message")||""),u=Object(s.a)(o,2),l=u[0],p=u[1],f=Object(r.useState)(localStorage.getItem("photo")||""),d=Object(s.a)(f,2),h=d[0],b=d[1],m=j();Object(r.useEffect)((function(){localStorage.setItem("message",l)}),[l]),Object(r.useEffect)((function(){localStorage.setItem("photo",h)}),[h]);var g=function(){var e=Object(k.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!l){e.next=6;break}return c(!0),e.next=5,m(I({message:l,photoUrl:h}));case 5:c(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(B.jsxs)("form",{className:V.a.form,children:[Object(B.jsx)(Y,{message:l,onChange:function(e){p(e.target.value)}}),Object(B.jsx)("div",{className:V.a.photoInput,children:Object(B.jsx)($.a,{fullWidth:!0,label:"\u0424\u043e\u0442\u043e",variant:"outlined",value:h,onChange:function(e){b(e.target.value)}})}),Object(B.jsx)(i.a,{variant:"contained",disabled:a||!l,onClick:g,type:"submit",children:a?"\u0418\u0434\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430...":"\u0420\u0430\u0437\u043e\u0441\u043b\u0430\u0442\u044c"})]})},ee=n(50),te=n.n(ee),ne=Object(_.b)("user/fetchName",function(){var e=Object(k.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){y()("https://api.vk.com/method/account.getProfileInfo?&access_token=".concat(t,"&v=").concat(C),void 0,(function(t,r){t?(console.error(t),n(t)):e("".concat(r.response.first_name," ").concat(r.response.last_name))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),re=Object(_.c)({name:"user",initialState:{token:"",name:""},reducers:{changeToken:function(e,t){e.token=t.payload},changeName:function(e,t){e.name=t.payload}},extraReducers:function(e){e.addCase(ne.fulfilled,(function(e,t){e.name=t.payload}))}}),ae=re.actions,ce=ae.changeToken,oe=(ae.changeName,re.reducer),se=function(){var e=m((function(e){return e.user.token})),t=j();return Object(B.jsxs)("div",{className:te.a.container,children:[Object(B.jsx)("a",{href:"https://oauth.vk.com/authorize?client_id=7218002&redirect_uri=https://oauth.vk.com/blank.html&display=popup&scope=wall,offline,groups&response_type=token&v=".concat(C),className:te.a.label,children:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d"}),Object(B.jsx)($.a,{id:"input-token",label:"\u0422\u043e\u043a\u0435\u043d",variant:"outlined",onChange:function(e){if(e.target.value)try{var n=new URL(e.target.value.replace("#","?")).searchParams.get("access_token");n&&t(ce(n))}catch(r){console.error(r)}},value:e})]})},ue=function(e){var t=j(),n=m((function(e){return e.user.token})),a=m((function(e){return e.user.name}));return Object(r.useEffect)((function(){n&&t(ne(n))}),[n,t]),a&&n?Object(B.jsxs)("div",{children:[Object(B.jsx)("h1",{children:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442"}),Object(B.jsx)("div",{children:a})]}):Object(B.jsx)(se,{})},ie=function(){return Object(B.jsxs)(o.a,{maxWidth:"xl",children:[Object(B.jsx)(ue,{}),Object(B.jsx)(Z,{}),Object(B.jsx)(Q,{})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var le=Object(_.a)({reducer:{user:oe,groups:E}});c.a.render(Object(B.jsx)(b.a,{store:le,children:Object(B.jsx)(ie,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[83,1,2]]]);
//# sourceMappingURL=main.5c990870.chunk.js.map